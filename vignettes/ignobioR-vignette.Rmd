---
title: "ignobioR vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# ignobioR

**Version 2.0.0 - Next Generation Floristics toolkit for R**

## Overview

The `ignobioR` package implements Next Generation Floristics (NGF) methodology to explicitly account for spatial and temporal uncertainties in botanical occurrence records. It provides two core analytical tools:

1. **Map of Relative Floristic Ignorance (MRFI)** - Quantifies and visualizes knowledge gaps across your study area
2. **Virtual Floristic List (VFL)** - Generates probabilistic species lists accounting for spatial and temporal uncertainty

## Installation
```r
# Install from GitHub
if(!require(devtools)) install.packages("devtools")
devtools::install_github("interacquas/ignobioR")
```

## Data Requirements

Both functions require occurrence data with these fields:
- `Taxon`: Species name
- `Long`, `Lat`: Coordinates (WGS84 or specify CRS)
- `uncertainty`: Spatial uncertainty radius in meters
- `year`: Year of observation
```r
library(ignobioR)

# Load example data
data(floratus)      # Occurrence records
data(park)          # Study area polygon
data(unsuitablezone) # Areas to exclude (optional)
```

---

## Map of Relative Floristic Ignorance (MRFI)

The MRFI quantifies floristic knowledge gaps by creating uncertainty buffers around occurrences and computing spatio-temporal ignorance scores. Higher values indicate less knowledge.

### Key Parameters

- `tau`: Temporal decay rate (0-100%). Typical values: 10-30%. Represents % knowledge loss per 100 years.
- `cellsize`: Resolution in meters. Choose based on study area size (e.g., 1000m-5000m).
- `excl_areas`: Areas to exclude (e.g., water bodies for terrestrial flora).
- `site_buffer`: Expand analysis beyond site boundary (default: FALSE).
- `use_coverage_weighting`: TRUE (accurate, slower) or FALSE (fast approximation).

### Example 1: Basic MRFI
```r
# Standard analysis with moderate temporal decay
mrfi_basic <- ignorance_map(
  data_flor = floratus,
  site = park,
  excl_areas = unsuitablezone,
  tau = 20,           # 20% knowledge loss per century
  cellsize = 2000     # 2 km resolution
)

# View results
terra::plot(mrfi_basic$MRFI, main = "Floristic Ignorance")
terra::plot(mrfi_basic$RICH, main = "Species Richness")
print(mrfi_basic$Statistics)
```

### Example 2: High-Resolution Analysis
```r
# Finer resolution for detailed mapping
mrfi_detailed <- ignorance_map(
  data_flor = floratus,
  site = park,
  excl_areas = unsuitablezone,
  tau = 15,                    # Conservative temporal decay
  cellsize = 1000,             # 1 km resolution
  use_coverage_weighting = TRUE # Maximum accuracy
)
```

### Example 3: Analysis with Expanded Area
```r
# Extend analysis beyond park boundaries
# Analyzes a larger region to map floristic knowledge in surrounding areas
mrfi_buffered <- ignorance_map(
  data_flor = floratus,
  site = park,
  excl_areas = unsuitablezone,
  tau = 20,
  cellsize = 2000,
  site_buffer = TRUE,    # Analyze beyond boundaries
  buffer_width = 5000    # 5 km expansion
)
```

**Output Files** (saved to `./output/`):
- 4-page PDF report with maps, diagnostics, and statistics
- GeoTIFF raster (MRFI_map.tif)
- Species list CSV

---

## Virtual Floristic List (VFL)

The VFL estimates taxon occurrence probabilities using spatial overlap and temporal decay, aggregated through the inclusion-exclusion principle.

### Key Parameters

- `tau`: Temporal decay rate (same interpretation as MRFI).
- `upperlimit`: Max records per taxon. 10 = fast, 20 = default, 30 = slow but accurate.
- `min_probability`: Filter taxa below threshold (0-100%).

### Example 1: Standard VFL
```r
# Generate probabilistic species list
vfl_standard <- virtual_list(
  data_flor = floratus,
  site = park,
  excl_areas = unsuitablezone,
  tau = 20,
  upperlimit = 20,        # Balanced speed/accuracy
  min_probability = 5     # Exclude taxa < 5%
)

# View results
head(vfl_standard$VFL, 10)
summary(vfl_standard$VFL$Estimated_Spatiotemporal_probability)
```

### Example 2: Fast Exploratory Analysis
```r
# Quick analysis for initial exploration
vfl_fast <- virtual_list(
  data_flor = floratus,
  site = park,
  tau = 20,
  upperlimit = 10,         # Fast computation
  min_probability = 0      # Include all taxa
)
```

### Example 3: High-Accuracy Conservation Analysis
```r
# Maximum accuracy for conservation decisions
vfl_conservation <- virtual_list(
  data_flor = floratus,
  site = park,
  excl_areas = unsuitablezone,
  tau = 10,                # Conservative decay
  upperlimit = 30,         # Maximum accuracy
  min_probability = 10     # Only confident predictions
)

# Identify poorly-documented but likely-present species
high_priority <- vfl_conservation$VFL[
  vfl_conservation$VFL$Estimated_Spatiotemporal_probability > 50 &
  vfl_conservation$VFL$Number_of_records < 5, 
]
print(high_priority)
```

**Output Files** (saved to `./output/`):
- 2-page PDF report with distribution histograms and statistics
- Probability table CSV

---

## What's New in 2.0.0

- **Modern spatial packages**: Migrated from `raster`/`sp` to `sf`/`terra`
- **Enhanced visualizations**: Automatic PDF reports with quantile and continuous scales
- **Improved accuracy**: Coverage-weighted rasterization option

---

## Citation

If you use this package, please cite:

D'Antraccoli, M., Bedini, G., & Peruzzi, L. (2022). Maps of relative floristic ignorance and virtual floristic lists: An R package to incorporate uncertainty in mapping and analysing biodiversity data. *Ecological Informatics*, 67, 101512. https://doi.org/10.1016/j.ecoinf.2021.101512

---

## Authors

- Marco D'Antraccoli ([University of Pisa](https://people.unipi.it/marco_dantraccoli/))
- Giuseppe Antonelli ([ResearchGate](https://www.researchgate.net/profile/Giuseppe-Antonelli))
- Gianni Bedini ([University of Pisa](https://people.unipi.it/gianni_bedini/))
- Lorenzo Peruzzi ([University of Pisa](https://people.unipi.it/lorenzo_peruzzi/))

## Learn More

- Source code: https://github.com/interacquas/ignobioR